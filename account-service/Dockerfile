FROM adoptopenjdk/openjdk16:jre

ENV SERVER_PORT=8443
EXPOSE $SERVER_PORT

ENV REVISION="0.0.1-SNAPSHOT"
COPY build/libs/template-account-service-${REVISION}.jar app.jar

ENV SSL_ENABLED=true
ENV NON_SSL_ENABLED=false
ENV SSL_KEY_STORE="classpath:keystore/template.p12"
ENV SSL_KEY_STORE_PASSWORD="changeit"
ENV SSL_TRUST_STORE="classpath:keystore/truststore.p12"
ENV SSL_TRUST_STORE_PASSWORD="changeit"
ENV SSL_TRUST_STORE_IGNORE_DOMAIN=true

ENV DATASOURCE_URL="jdbc:mariadb://mariadb:3306/template_account"
ENV DATASOURCE_USERNAME="template_account"
ENV DATASOURCE_PASSWORD="changeit"

ENV KEYCLOAK_URL="https://auth:8444"
ENV KEYCLOAK_REALM="template"
ENV KEYCLOAK_CLIENT_ID="template-app"
ENV KEYCLOAK_CLIENT_SECRET="be795f62-6b97-4bf0-9287-0bae9e47992f"
ENV KEYCLOAK_USERNAME="admin"
ENV KEYCLOAK_PASSWORD="admin"

ENV IRON_SESSION_COOKIE_NAME="template-account-session"
ENV IRON_SESSION_PASSWORDS="viPDqiurYq7Fz9h8swv2SNdhveoXDxOG"
ENV IRON_SESSION_SECURE=true

ENV EUREKA_DEFAULT_ZONE="https://discovery:changeit@discovery:8761/eureka/"

ENTRYPOINT java -jar app.jar \
  -DSERVER_PORT=$SERVER_PORT \
  -DSSL_ENABLED=$SSL_ENABLED \
  -DNON_SSL_ENABLED=$NON_SSL_ENABLED \
  -DSSL_KEY_STORE=$SSL_KEY_STORE \
  -DSSL_KEY_STORE_PASSWORD=$SSL_KEY_STORE_PASSWORD \
  -DSSL_TRUST_STORE=$SSL_TRUST_STORE \
  -DSSL_TRUST_STORE_PASSWORD=$SSL_TRUST_STORE_PASSWORD \
  -DSSL_TRUST_STORE_IGNORE_DOMAIN=$SSL_TRUST_STORE_IGNORE_DOMAIN \
  -DDATASOURCE_URL=$DATASOURCE_URL \
  -DDATASOURCE_USERNAME=$DATASOURCE_USERNAME \
  -DDATASOURCE_PASSWORD=$DATASOURCE_PASSWORD \
  -DKEYCLOAK_URL=$KEYCLOAK_URL \
  -DKEYCLOAK_REALM=$KEYCLOAK_REALM \
  -DKEYCLOAK_CLIENT_ID=$KEYCLOAK_CLIENT_ID \
  -DKEYCLOAK_CLIENT_SECRET=$KEYCLOAK_CLIENT_SECRET \
  -DKEYCLOAK_USERNAME=$KEYCLOAK_USERNAME \
  -DKEYCLOAK_PASSWORD=$KEYCLOAK_PASSWORD \
  -DIRON_SESSION_COOKIE_NAME=$IRON_SESSION_COOKIE_NAME \
  -DIRON_SESSION_PASSWORDS=$IRON_SESSION_PASSWORDS \
  -DIRON_SESSION_SECURE=$IRON_SESSION_SECURE \
  -DEUREKA_DEFAULT_ZONE=$EUREKA_DEFAULT_ZONE
