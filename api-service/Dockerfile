FROM adoptopenjdk/openjdk16:jre

ENV SERVER_PORT=8443
EXPOSE $SERVER_PORT

ENV REVISION="0.0.1-SNAPSHOT"
COPY build/libs/template-api-service-${REVISION}.jar app.jar

ENV SSL_ENABLED=true
ENV NON_SSL_ENABLED=false
ENV SSL_KEY_STORE="classpath:keystore/template.p12"
ENV SSL_KEY_STORE_PASSWORD="changeit"
ENV SSL_TRUST_STORE="classpath:keystore/truststore.p12"
ENV SSL_TRUST_STORE_PASSWORD="changeit"
ENV SSL_TRUST_STORE_IGNORE_DOMAIN=true

ENV KEYCLOAK_URL="https://auth:8444"
ENV KEYCLOAK_REALM="template"

ENV EUREKA_DEFAULT_ZONE="https://discovery:changeit@discovery:8761/eureka/"

ENTRYPOINT java -jar app.jar \
  -DSERVER_PORT=$SERVER_PORT \
  -DSSL_ENABLED=$SSL_ENABLED \
  -DNON_SSL_ENABLED=$NON_SSL_ENABLED \
  -DSSL_KEY_STORE=$SSL_KEY_STORE \
  -DSSL_KEY_STORE_PASSWORD=$SSL_KEY_STORE_PASSWORD \
  -DSSL_TRUST_STORE=$SSL_TRUST_STORE \
  -DSSL_TRUST_STORE_PASSWORD=$SSL_TRUST_STORE_PASSWORD \
  -DSSL_TRUST_STORE_IGNORE_DOMAIN=$SSL_TRUST_STORE_IGNORE_DOMAIN \
  -DKEYCLOAK_URL=$KEYCLOAK_URL \
  -DKEYCLOAK_REALM=$KEYCLOAK_REALM \
  -DEUREKA_DEFAULT_ZONE=$EUREKA_DEFAULT_ZONE
